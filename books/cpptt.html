<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <link rel="stylesheet" href="../bootstrap-3.3.5/css/bootstrap.min.css">
  <link rel="stylesheet" href="../theme.css">
  <title>C++テンプレートテクニック 初版 - Faith and Brave</title>
  <style type="text/css">code{white-space: pre;}</style>
</head>
<body>
  <nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">Faith and Brave</a>
      </div>
      <div id="navbar" class="collapse navbar-collapse">
        <ul class="nav navbar-nav navbar-right">
          <li><a href="https://github.com/faithandbrave/site">GitHub Project</a></li>
        </ul>
      </div>
    </div>
  </nav>
  <div class="container">
    <div class="row">
      <div class="col-xs-3">
        <ul class="nav nav-pills nav-stacked">
          <li class="active"><a href="../index.html">ホーム</a></li>
          <li><a href="../profile.html">プロフィール</a></li>
          <li><a href="../publication.html">発表資料や出版物</a></li>
          <li><a href="#">コントリビューション履歴</a></li>
        </ul>
      </div>
      <div class="col-xs-9">
<h1 id="cテンプレートテクニック-初版">C++テンプレートテクニック 初版</h1>
<p><a href="http://www.amazon.co.jp/dp/4797376686/ref=as_sl_pc_tf_lc?tag=faithandbrave-22&amp;camp=243&amp;creative=1615&amp;linkCode=as1&amp;creativeASIN=4797376686&amp;adid=1DEH8ZMYCH8VJ1SAJRZB&amp;&amp;ref-refURL=http%3A%2F%2Ffaithandbrave.hateblo.jp%2F">本書の最新版はこちらです。</a></p>
<p><img src="../image/cpptt.jpg"></p>
<ul>
<li>書名 : 『C++テンプレートテクニック - 簡潔で再利用しやすいコードのためのC++活用術』<br /></li>
<li>著者 : επιστημη、高橋 晶<br /></li>
<li>編集 : 白川 潤一<br /></li>
<li>出版社 : ソフトバンククリエイティブ<br /></li>
<li>ページ数 : 352<br /></li>
<li>ISBN-10 : 4797354534<br /></li>
<li>ISBN-13 : 978-4797354539<br /></li>
<li>発売日： 2009年4月25日<br /></li>
<li><a href="http://www.sbcr.jp/support/8672.html">正誤情報はこちら</a></li>
</ul>
<h2 id="購入先">購入先</h2>
<ul>
<li><a href="http://www.amazon.co.jp/dp/4797354534/ref=as_sl_pc_tf_lc?tag=faithandbrave-22&amp;camp=243&amp;creative=1615&amp;linkCode=as1&amp;creativeASIN=4797354534&amp;adid=1HZB8Y5VN0EJWVQ2J9X0&amp;&amp;ref-refURL=http%3A%2F%2Ffaithandbrave.hateblo.jp%2Fentry%2F20090408%2F1239205628">Amazon.co.jp</a><br /></li>
<li><a href="http://www.sbcr.jp/products/4797354539.html">SBクリエイティブ</a></li>
</ul>
<h2 id="書籍概要">書籍概要</h2>
<p>本書は、プログラミング言語C++の特徴的な機能である「テンプレート」を使用した、さまざまな技法を紹介しています。</p>
<p>C++のテンプレートは、パラメタライズド・タイプ(parameterized type)という、処理に使用する型をパラメータ化する機能です。この機能を使用することにより、型が違うだけで同じことをするプログラムコードを共通化でき、コードの再利用性を高めることができます。その共通化は、簡単なコードであればテンプレートを単に使用するだけで行えますが、「特定の型、または特定の条件に一致する型の場合は、違うことをしたい」のような要求が発生した場合には、いくつかの「技法」が必要になります。</p>
<p>本書で紹介するテンプレートに関する技法は、C++のユーザーコミュニティが長年かけて編み出してきたものたちです。C++は、「言語機能は極力増やさない。できるかぎりライブラリで実現せよ」という設計思想を持った言語です。そのため、ライブラリを作るユーザーが「技を編み出す」という場面が多くあります。本書はそういった、ひらめきの結晶、人類の叡智といったものを集めた書籍になっています。<br />本書を読むことで、テンプレートを使用した既存の技法を身につけるだけでなく、新たな技法を編み出し、C++やプログラミングをさらなる高みへと押し上げてくれる方が現れることを願っております。</p>
<h2 id="コンセプト">コンセプト</h2>
<ul>
<li>C++入門書に記載されているテンプレートの解説と、難しいと言われているテンプレート技法の書籍<a href="https://www.amazon.co.jp/dp/4894714353?tag=faithandbrave-22&amp;camp=1027&amp;creative=7407&amp;linkCode=as4&amp;creativeASIN=4894714353&amp;adid=1P3B388D777W6VBNQR7Y&amp;">『Modern C++ Design』</a>の中間になる本を出そう。<br /></li>
<li>執筆当時は、C++テンプレートの有名な書籍である<a href="https://www.amazon.co.jp/dp/0201734842?tag=faithandbrave-22&amp;camp=1027&amp;creative=7407&amp;linkCode=as4&amp;creativeASIN=0201734842&amp;adid=0YKDDDCSSPTSDY2MXQFN&amp;">『C++ Templates: The Complete Guide』</a>や<a href="https://www.amazon.co.jp/dp/B003XNTTBW?tag=faithandbrave-22&amp;camp=1027&amp;creative=7407&amp;linkCode=as4&amp;creativeASIN=B003XNTTBW&amp;adid=0ET2VW05FGP32TVE8HYD&amp;">『C++ Template Metaprogramming』</a>がまだ日本語訳されていなかったので、そのあたりもカバーしよう。</li>
</ul>
<h2 id="担当分け">担当分け</h2>
<p>第1章から第3章は、επιστημηさん、それ以降の第4章から第12章を私、というように担当を設定していました。著者の内部的には「基礎」と「発展」の二部構成にしてあります。<br />しかし実際には、επιστημηさんがお忙しい時期があったために、私も第2章と第3章をお手伝いしていました。</p>
<h2 id="執筆期間">執筆期間</h2>
<p>執筆期間は、私が参加したネタ出しと章立て、および執筆とレビューが完了したあとの校正も含めて、約1年間でした。<br />ペースとしては、1ヶ月に2章ずつ仕上げました。<br />私とエピさんが書き上がった時点から、レビュアーさんたちにレビューをしてもらい、そのレビューと直しに3ヶ月ほどかかりました。</p>
<h2 id="表紙デザイン">表紙デザイン</h2>
<p>本書の表紙には、スパナ、ドライバー、六角レンチなどが並んでいます。<a href="https://www.amazon.co.jp/dp/4894714353?tag=faithandbrave-22&amp;camp=1027&amp;creative=7407&amp;linkCode=as4&amp;creativeASIN=4894714353&amp;adid=1P3B388D777W6VBNQR7Y&amp;">『Modern C++ Design』</a>の表紙が10徳ナイフなので、それにあやかったものになっています。10徳ナイフは、「テンプレートというひとつの機能が、多くのことを表現できる」とかそういったことを表現しているのでしょう。<br />本書の表紙デザインは編集側が考えたものですが、正直なところ、私は気に入っていません。私の印象では、本書が<a href="https://www.amazon.co.jp/dp/4894714353?tag=faithandbrave-22&amp;camp=1027&amp;creative=7407&amp;linkCode=as4&amp;creativeASIN=4894714353&amp;adid=1P3B388D777W6VBNQR7Y&amp;">『Modern C++ Design』</a>の劣化版であることを表現しているように感じます。<br />第2版の方は、私に表紙デザインのコンセプトを決めさせてもらえたので、非常に気に入っています。そちらのデザインについては、第2版のページで解説します。</p>
<h2 id="本書執筆の経緯">本書執筆の経緯</h2>
<p>ある日、私のもとに、επιστημη(えぴすてーめー)さんから一本のメールが来ました。</p>
<p>エピ：「いま、テンプレートの本を書こうとしてるんだけど、なんかネタない？」<br />私： 「思いつく限りのネタを列挙してみました。(テンプレートメタプログラミング、SFINAE、テンプレート型変換演算子、ポリシーに基づく設計など)」<br />エピ： 「じゃあ、書いて♪」</p>
<p>こういった経緯から、書籍の執筆に関われるチャンスだと思い、執筆に参加させていただくことになりました。<br />エピさんとは、わんくま同盟の東京勉強会で知り合いました。このとき声を掛けていただいたのは、私がわんくま同盟の勉強会で、C++0xコンセプトの発表をしたからだったと思います。</p>
<h2 id="書かなかったこと">書かなかったこと</h2>
<p>当時、知っていながら書かなかったものが、いくつかあります。</p>
<p>まず、型リスト。<a href="https://www.amazon.co.jp/dp/4894714353?tag=faithandbrave-22&amp;camp=1027&amp;creative=7407&amp;linkCode=as4&amp;creativeASIN=4894714353&amp;adid=1P3B388D777W6VBNQR7Y&amp;">『Modern C++ Design』</a>でも大きく取り上げられ、実際に有用な技法でした。しかし、C++03でBoost.MPLのような優れた型リストを実装するのは困難がともなうのと、当時C++0xに可変引数テンプレートが導入予定だということがわかっていたこともあり、本書初版では紹介しませんでした。<br />型リストは、第2版でC++11に対応する際、改めて紹介を書きました。</p>
<p>もうひとつは、「他言語でのテンプレート相当の機能紹介」です。これはたとえば、JavaやC#のジェネリクス、Haskellの多相型・型クラス、Ruby界隈で使われる用語「ダック・タイピング」などです。これらは、本書の技法が他言語でも役立つこと、またその逆に、他言語ユーザーでも本書の技法が良い学びになること、いろいろな言語の似て非なる機能を学ぶことで知見を広めてもらいたい、などを目的としたかったのです。しかしこれは断念しました。その理由としては、私の中途半端な知識で、他言語について書きたくなかったからです。しっかりしたものを書くには、それなりの調査期間が必要となりますが、その期間を確保するのが難しかったため、書かないことにしました。</p>
<h2 id="執筆の思い出">執筆の思い出</h2>
<h3 id="文章の書き方説明の量">文章の書き方・説明の量</h3>
<p>当時の私は、ブログで公開文章を書いてはいましたが、それほどうまく日本語を扱えていたわけではありませんでした。雑誌のような企業が管理する媒体での記事執筆もしていませんでした。私がブログで書く文章は「ひとつの記事が、1〜2分程度で簡潔に読めるように」を心がけていたこともあって、あまり詳細な説明も書いてきませんでした。<br />そのため、書籍というターゲット環境向けに文章を書くのに、少し戸惑いました。編集さんにもそう説明した上で、試しにひとつの章を書いて、それを編集さんに見てもらうことにしました。それを見てもらって編集さんに言われたのが「説明は、書きすぎるということはないから、もっと書いてほしい」ということでした。これはその後に文章を書くときにも、よく思い出す言葉です。<br />本書初版は、私のこれまでの癖もあって、簡潔な説明が多く残っています。それに対して「説明がさらっとしていて読みやすい」という好意的な感想も多くいただきました。しかしやはり、とくに書籍という媒体では、しっかりとした説明が必要だと考えてその後文章を書いてきたので、今ではもう、あのときのような簡潔な文章は無意識には書けなくなっています。</p>
<h3 id="レビュアー集め">レビュアー集め</h3>
<p>本書の執筆において、ひと通りの内容を書ききった段階から、何人かのC++エキスパートにレビューをしていただくことにしました。レビュアー集めは、私とエピさんが声をかけました。そのときに集まったメンバー主に、わんくま同盟コミュニティのつながりでした。それに加えて、C++標準化委員会で知り合った<a href="https://github.com/uskz">uskzさん</a>と<a href="https://github.com/redboltz">近藤さん</a>にも参加していただけました。編集さんにもお願いすればレビュアーを探してきてもらえるのですが、私たち著者のつながりでレビュアー集めをしました。信頼できる方々とのつながりがあったのは幸いでした。</p>
<h3 id="動機が弱い">動機が弱い</h3>
<p>レビューには、プログラマにはおなじみのバグ管理システムTracを使用しました。これは、<a href="https://github.com/redboltz">近藤さん</a>がシステムを用意してくれました。<br />書籍という媒体で文章を書いたことがないのは、やはり大きかったです。<a href="https://github.com/melpon">めるぽん</a>と<a href="https://github.com/redboltz">近藤さん</a>から、「動機が弱い」という問題が報告されるたびに、頭を抱えていたのを覚えています。そのたびに、紹介している技法を調べ直し、動機やユースケースを収集し、文章をまとめ直したりしていました。彼らが発売前に指摘してくれなかったら、本書は「何に役立つのかわからない」「こんなのはただの遊びだ、実用的じゃない」というような評価が大半になっていたことでしょう。</p>
<h3 id="調査不足と思い込み">調査不足と思い込み</h3>
<p>第11章で書いた「Extension Member Function」というのは、C#の言語機能である「拡張メソッド(Extension Method)」をC++で実現しよう、というもので、私が名前を付けたものです。これは、PStade.OvenやBoost.Rangeが採用しているパイプ演算子(<code>operator|()</code>)を、Rangeアダプタとして使用するだけでなく、メンバ関数を後付けする汎用的な技法にしよう、と思い立って書いた章になります。<br />この章のために、いくつかのRangeアダプタの実装を紹介用に書いて、それをもとに文章にまとめました。それに対して<a href="https://github.com/uskz">uskzさん</a>から、「この実装では遅延評価が考慮されていない。PStade.OvenとBoost.Rangeは、イテレータによって処理を遅延させていて、Rangeアダプタがその場で処理を実行するわけではない」という指摘が行われました。私は、Rangeアダプタの技術を正しく理解しない状態で、執筆を進めていたのでした。<a href="https://github.com/uskz">uskzさん</a>に多大な感謝をしつつ、Rangeアダプタの概念と実装を調べ直し、この章をまるまる書き直すことになりました。<br />あのときは自分の不甲斐なさにだいぶ落ち込んだものですが、これもまた、発売前のレビューが重要だと思えた出来事でした。</p>
<h3 id="サンプルコードはとっておくべし">サンプルコードはとっておくべし</h3>
<p>文章中に載せるコードは、自分でサンプルコードを書いて、Wordの原稿データに貼り付け、元のサンプルコードを破棄していました。そのようにしていたため、レビュー段階になって、複数コンパイラでの検証が難しくなりました。あのときは、<a href="https://github.com/andochin">あんどちんさん</a>が原稿データからサンプルコードを手作業で抽出して、検証を進めてくれました。そのことがあってからは、使用したサンプルコードは、しっかりとっておくようにしました。</p>
<h3 id="編集さんはプログラマではない">編集さんはプログラマではない</h3>
<p>編集さんはプログラマというわけではないので、こちらが指定しないとわからないことがあります。<br />たとえば、可変引数を表すコード中の「<code>...</code>」(ドットx3)を、省略形だと判断して「<code>…</code>」(三点リーダー)に置き換えてしまったりします。「ドットx3は、プログラムとして意味のあるものですので、置き換えないでください」のように、指示してあげる必要があります。<br />文章中のコードも、編集さんの判断で等幅フォントにしてくれたりはしませんので、等幅フォントにしたいところは、全て指示してあげる必要があります。</p>
<h3 id="日の執筆量">1日の執筆量</h3>
<p>書籍1冊の分量は、目安として最低で300ページ。編集さんからは「それより少ないと値段がつけられない」と言われていました。<br />本の大きさはB5版だと事前にわかっていたので、それに合わせて、1日に何ページくらい書けるのかを測定しました。そのときは、休日に丸1日かけて11ページが限界でした。そして、1日に限界まで作業すると、あとが続かないこともわかりました。<br />書籍は情熱をもって「えいやっ」という感じで一気に書き上げることはできません。これには、私は本業が別にあり、副業としてプライベートの時間や仕事の合間に作業をしているので、書籍に全力で取り組むことができないという理由も含まれます。しかし、情熱は短期間しかもたない、というのがより大きな理由です。たとえフルタイムで書籍の執筆に携われたとしても、数日程度なら続いたとしても、数十日は情熱が維持できません。<br />クリエイティブな仕事をしている人はおそらく皆そうなのだと思いますが、私は飽きっぽい性格も相まって、やりたいことが毎日のように溢れてきます。そうすると、ひとつのことに情熱を注いでいるとそのうちに「ほかにもやりたいことがあるのに…」とイライラしてきてしまいます。そこでほかのことを一度はじめてしまうと、元々やっていた作業の優先度がどんどん下がっていってしまいます。そうなると最悪の場合、書籍の執筆が中断、もしくは断念ということになりかねません。<br />期間が長い副業を続けるには、情熱を抑えて習慣化する必要があります。1日の作業量を減らし、毎日無理なく進められるくらいにするのがいいでしょう。(関連記事：<a href="http://faithandbrave.blogspot.jp/2012/10/blog-post_27.html">「情熱はときに邪魔になる - 信念と勇気、その先へ」</a>)</p>
<h3 id="レビュー指摘数">レビュー指摘数</h3>
<p>Tracに投稿されたレビューの件数は、400件ちょっとでした。1ページに1つ以上は指摘があった計算になります。<br />書籍は一度発売してしまうと修正がきかない媒体です。これは、バグに関する要求が非常に厳しいソフトウェアを書いているようなものです。読者からはバグが0件の製品のみが求められている、と考えて取り組みました。<br />レビューが投稿されると、うんざりすることもありますが、それを直すたびに安心感が増します。</p>
<h2 id="執筆ツール">執筆ツール</h2>
<ul>
<li>原稿執筆 : (私は)Microsoft Word<br /></li>
<li>連絡 : メール<br /></li>
<li>レビュー : バグ管理システム<a href="http://trac.edgewall.org/">Trac</a><br /></li>
<li>校正データ(PDF)のストレージ : Microsoft SkyDrive</li>
</ul>
<h2 id="振り返り">振り返り</h2>
<p>私にとって初の書籍執筆だったこともあり、執筆のツールとして、よく考えずにMicrosoft Wordを使っていました。<br />あとになって振り返ると、ツールの選択は失敗でした。Wordには校正機能がついているため、些細な日本語の間違いは指摘してくれます。しかし、プログラムコードが多く出てくる書籍ではやはり、リッチテキストエディタよりも、プレーンテキストエディタの方が何かと都合がいいです。プレーンテキストの方はたとえば、バージョン管理システムとの相性がいいので、レビューの管理もしやすくなります。</p>
<p>レビューのツールとしてTracを使用したのは、成功でした。<br />レビュアーが指摘し、著者とともに修正内容を検討し、編集さんがPDFに反映させ、確認がとれたらチケットを閉じる、という一連の流れがよどみなく動いていました。</p>
<h2 id="執筆後の思い出">執筆後の思い出</h2>
<p>私が<a href="https://github.com/redboltz">近藤さん</a>とC++Now! 2012に参加したとき、書籍<a href="https://www.amazon.co.jp/dp/0201734842?tag=faithandbrave-22&amp;camp=1027&amp;creative=7407&amp;linkCode=as4&amp;creativeASIN=0201734842&amp;adid=0YKDDDCSSPTSDY2MXQFN&amp;">『C++ Templates: The Complete Guide』</a>の著者である<a href="http://www.vandevoorde.com/Daveed/">Daveed Vandevoordeさん</a>がキーノートの発表者として来ていました。そのとき、私たちの『C++テンプレートテクニック』をDaveedさんにプレゼントしました。<a href="https://www.amazon.co.jp/dp/0201734842?tag=faithandbrave-22&amp;camp=1027&amp;creative=7407&amp;linkCode=as4&amp;creativeASIN=0201734842&amp;adid=0YKDDDCSSPTSDY2MXQFN&amp;">『C++ Templates』</a>はすばらしい書籍でした。その著者の方とお会いでき、さらに自分が書いた本を受け取っていただけて、非常にうれしかったです。<br />私が持参した<a href="https://www.amazon.co.jp/dp/0201734842?tag=faithandbrave-22&amp;camp=1027&amp;creative=7407&amp;linkCode=as4&amp;creativeASIN=0201734842&amp;adid=0YKDDDCSSPTSDY2MXQFN&amp;">『C++ Templates』</a>に、サインもいただけました。</p>
<p><img src="../image/david_signiture.jpg" width="60%"></p>
<p>また、そのときのC++Now!では、書籍<a href="https://www.amazon.co.jp/dp/B003XNTTBW?tag=faithandbrave-22&amp;camp=1027&amp;creative=7407&amp;linkCode=as4&amp;creativeASIN=B003XNTTBW&amp;adid=0ET2VW05FGP32TVE8HYD&amp;">『C++ Template Metaprogramming』</a>の著者である<a href="http://daveabrahams.com/">Dave Abrahamsさん</a>にもお会いできました。じつはそのときは、彼に用事があったからC++Now!に行ったのでした(『プログラミングの魔導書 Vol.2』で彼にインタビューをしたので、その関係です)。<br />Daveにも、私が持参した<a href="https://www.amazon.co.jp/dp/B003XNTTBW?tag=faithandbrave-22&amp;camp=1027&amp;creative=7407&amp;linkCode=as4&amp;creativeASIN=B003XNTTBW&amp;adid=0ET2VW05FGP32TVE8HYD&amp;">『C++ Template Metaprogramming』</a>に、サインをいただけました。</p>
<p><img src="../image/dave_signiture.jpg" width="60%"></p>
<p>C++テンプレートに関する偉大な名著を書かれたこのお二人に会えて、サインもいただけて、感謝感激です。</p>
<h2 id="関連ページ">関連ページ</h2>
<ul>
<li><a href="http://faithandbrave.hateblo.jp/entry/20090408/1239205628">『C++テンプレートテクニック』もうすぐ発売です。 - Faith and Brave - C++で遊ぼう</a><br /></li>
<li><a href="http://d.hatena.ne.jp/redboltz/20120519/1337385881">C++Now2012体験記 - redboltzの日記</a></li>
</ul>
      </div>
    </div>
  </div>
</body>
</html>
